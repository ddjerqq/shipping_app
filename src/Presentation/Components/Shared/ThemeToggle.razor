@inject IJSRuntime Js
@implements IAsyncDisposable

@ChildContent

<div id="theme-dropdown" class="z-30 hidden divide-background-100 rounded-lg shadow w-36 border bg-background">
    <Button Variant="ghost" class="shadow-none justify-start w-full rounded-none" @onclick="@(async () => await SetTheme("light"))">
        <Blazicon Svg="Icons.Sun"/>
        Light
    </Button>
    <Button Variant="ghost" class="shadow-none justify-start w-full rounded-none" @onclick="@(async () => await SetTheme("dark"))">
        <Blazicon Svg="Icons.Moon"/>
        Dark
    </Button>
    <Button Variant="ghost" class="shadow-none justify-start w-full rounded-none" @onclick="@(async () => await SetTheme("system"))">
        <Blazicon Svg="Icons.Monitor"/>
        System
    </Button>
</div>


@code {
    [Parameter, EditorRequired]
    public RenderFragment ChildContent { get; set; } = null!;
    
    private IJSObjectReference? _module;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            _module = await Js.InvokeAsync<IJSObjectReference>(
                "import",
                CancellationToken,
                "./Components/Shared/ThemeToggle.razor.js");
        }
    }

    private async Task SetTheme(string theme)
    {
        if (_module is not null)
            await _module.InvokeVoidAsync("setTheme", CancellationToken, theme);
    }

    public async ValueTask DisposeAsync()
    {
        if (_module is not null)
        {
            try
            {
                await _module.DisposeAsync();
            }
            catch (JSDisconnectedException)
            {
            }
        }
    }
}