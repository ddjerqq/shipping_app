@page "/auth/forgot_password"
@using Application.Cqrs.Users.Commands

<PageTitle>@Locale.forgot_password</PageTitle>
<PageHeader Title="@Locale.forgot_password" Description="@Locale.enter"/>

<AppForm @bind-Model="Command" OnValidSubmit="OnValidSubmitAsync">
    <FormField>
        <FormLabel for="email">@Locale.email</FormLabel>
        <FormInputText id="email"
                       @bind-Value="@Command.Email"
                       placeholder="name@example.com"
                       type="email"
                       required
                       autocomplete="email"
                       disabled="@IsLoading"/>

        <FormInvalidFeedback For="@(() => Command.Email)"/>
    </FormField>

    <Recaptcha @ref="@RecaptchaComponent"/>

    <Button type="submit" disabled="@IsLoading">
        @if (IsLoading)
        {
            <Blazicon Svg="Icons.Loader" class="mr-2 size-4 animate-spin"/>
        }
        @Locale.reset_password
    </Button>
</AppForm>

@code {
    private ForgotPasswordCommand Command { get; set; } = new();
    private Recaptcha RecaptchaComponent { get; set; } = null!;

    private async Task OnValidSubmitAsync()
    {
        if (!await RecaptchaComponent.IsValid())
        {
            ShowWarning(Locale.please_complete_captcha_before_continuing);
            return;
        }

        await SendCommandAsync(Command);

        NavigationManager.NavigateTo("auth/forgot_confirmation");
    }
}