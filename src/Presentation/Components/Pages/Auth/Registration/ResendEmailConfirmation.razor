@page "/auth/resend_email_confirmation"
@using Application.Cqrs.Users.Commands

<PageTitle>@Locale.resend_email_confirmation</PageTitle>

<PageHeader Title="@Locale.didnt_receive_an_email" Description="@Locale.enter_your_email_and_well_send_you_a_new_link"/>

<AppForm @bind-Model="Command" OnValidSubmit="OnValidSubmitAsync">
    <FormField>
        <FormLabel for="email">@Locale.email</FormLabel>
        <FormInputText id="email"
                       @bind-Value="@Command.Email"
                       placeholder="name@example.com"
                       type="email"
                       required
                       autocomplete="email"
                       disabled="@IsLoading"/>

        <FormInvalidFeedback For="@(() => Command.Email)"/>
    </FormField>

    <Recaptcha @ref="@RecaptchaComponent"/>

    <Button type="submit" disabled="@IsLoading">
        @if (IsLoading)
        {
            <Blazicon Svg="Icons.Loader" class="mr-2 size-4 animate-spin"/>
        }
        @Locale.resend
    </Button>
</AppForm>

@code {
    private ResendEmailConfirmationCommand Command { get; set; } = new();
        private Recaptcha RecaptchaComponent { get; set; } = null!;

    private async Task OnValidSubmitAsync()
    {
        if (!await RecaptchaComponent.IsValid())
        {
            ShowWarning(Locale.please_complete_captcha_before_continuing);
            return;
        }

        await SendCommandAsync(Command);

        NavigationManager.NavigateTo("auth/register_confirmation");
    }
}