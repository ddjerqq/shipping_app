@page "/track_package"
@using Application.Cqrs.Packages.Queries

<PageTitle>Track package</PageTitle>
<PageHeader Title="Track package"/>

<Card class="mt-4">
    <Header>
        <Description>Enter the package tracking code and see if we have it in the system</Description>
    </Header>

    <Content>
        <AppForm @bind-Model="Command" OnValidSubmit="OnValidSubmit">
            <FormField>
                <FormLabel for="tracking-code">Tracking Code</FormLabel>
                <FormInputText id="tracking-code"
                               @bind-Value="@Command.TrackingCode"
                               placeholder="Enter tracking code..."
                               required
                               disabled="@IsLoading"/>
                <FormInvalidFeedback For="@(() => Command.TrackingCode)"/>
            </FormField>

            <Button type="submit" disabled="@IsLoading">
                @if (IsLoading)
                {
                    <Blazicon Svg="Icons.Loader" class="mr-2 size-4 animate-spin"/>
                }
                Search
            </Button>
        </AppForm>
    </Content>
</Card>

@code {
    private GetPackageByTrackingCodeQuery Command { get; set; } = new();

    private async Task OnValidSubmit(EditContext obj)
    {
        var package = await SendCommandAsync(Command);
        if (package is null)
        {
            ShowError("Sorry! we could not find a package with that code in our system!");
            return;
        }

        NavigationManager.NavigateTo($"/packages/{package.Id}");
    }
}